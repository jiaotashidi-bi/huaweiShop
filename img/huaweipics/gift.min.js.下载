ec.pkg("ec.product.gift");ec.product.gift={prev:function(c){if($(c).hasClass("disabled")){return}var a=$(c).siblings(".pro-gallery-thumbs").find("ul"),h=$(c).siblings(".pro-gallery-thumbs").find("li"),b=$(c).siblings("a"),f=a.attr("data-choose"),i=parseInt(h.outerWidth(),10),g=h.length,d=Math.ceil(g/4),e=4*i;f--;a.attr("data-choose",f);a.animate({left:f*-e+"px"},100);if(f==0){$(c).addClass("disabled");b.removeClass("disabled");return}},next:function(c){if($(c).hasClass("disabled")){return}var a=$(c).siblings(".pro-gallery-thumbs").find("ul"),h=$(c).siblings(".pro-gallery-thumbs").find("li"),b=$(c).siblings("a"),f=a.attr("data-choose"),i=parseInt(h.outerWidth(),10),g=h.length,d=Math.ceil(g/4),e=4*i;f++;a.attr("data-choose",f);a.animate({left:f*-e+"px"},100);if(f>=d-1){$(c).addClass("disabled");b.removeClass("disabled");return}},changeGift:function(e){$(e).parent().siblings().removeClass("current");$(e).parent().addClass("current");var c=this.mainSkuGiftMap[this.sku];if(this.tempMainSbomGiftMap[this.sku]==undefined){this.tempMainSbomGiftMap=this.cloneObj(this.finalMainSbomGiftMap)}var b=this.tempMainSbomGiftMap[this.sku];var a=$(e).attr("key");var d=c[a];var f=$(e).attr("defaultGiftKey");b[f]=d;$("#giftimg_"+f).attr("alt",d.giftName);$("#giftimg_"+f).attr("src",this.picMediaServer+d.photoPath+this.middleImgSize+d.photoName);$("#giftHref_"+f).attr("href","/product/"+d.giftId+".html#"+d.giftSkuId);$("#giftTitleHref_"+f).attr("href","/product/"+d.giftId+".html#"+d.giftSkuId);$("#giftTitleHref_"+f).html(d.giftName);this.isChange=true},proGiftChosenImgSrc:"",proGiftChosenImgAlt:"",proGiftGallerys:[],giftTrees:[],data:"",giftArrays:{},defaultGift:[],mainSkuGiftMap:{},mainSkuGiftKeyMap:{},defaultGiftMap:{},finalMainSbomGiftMap:{},tempMainSbomGiftMap:{},isChange:"true",picMediaServer:ec.mediaPath,sku:"",middleImgSize:"428_428_",navImgSize:"55_55_",ITEM_WIDTH:52,isChange:false,edit:function(a){var b=this.getGiftsSize();height=$(window).height();if(b>3){b=680;height<=b*1.5?b=0.6*height:b}else{b=340}new ec.box(this.popupHtml(),{boxid:"gift_manager",boxclass:"ol_box_4",title:"\u9009\u62e9\u914d\u4ef6",width:940,height:b,okBtnName:"\u786e\u5b9a\u63d0\u4ea4",cancelBtnName:"\u53d6\u6d88",showButton:true,onok:function(c){ec.product.gift.confirm("true");c.close()},onclose:function(c){ec.product.gift.confirm("false")},focus:"box-title",autoHeight:false,autoPosition:true,}).open();$("#gift_manager").find("a.box-ok").css({color:"#fff",border:"1px solid #ca151e","background-color":"#ca151e"})},confirm:function(b){var e=0;if(this.isChange&&b=="true"){this.finalMainSbomGiftMap=this.cloneObj(this.tempMainSbomGiftMap)}else{this.tempMainSbomGiftMap={}}var a=this.finalMainSbomGiftMap[this.sku];for(var c in a){e++;var d=a[c];$("#gift_"+c).attr("giftskuId",d.giftSkuId);$("#gift_"+c).attr("src",this.picMediaServer+d.photoPath+this.navImgSize+d.photoName);$("#gift_"+c).attr("alt",d.giftName);$("#gift_"+c).attr("title",d.giftName)}},ftl:function(e,h){this.sku=ec.product.getSku();var c=[];c.push("<!-- 20170316-\u5546\u54c1\u7b80\u4ecb-\u914d\u4ef6\u9009\u62e9-start -->");c.push('<dl class="clearfix">');if(!h){c.push("<dt>\u4f18\u60e0\u4fe1\u606f\uff1a</dt>")}else{c.push("<dt></dt>")}c.push("<dd>");c.push('<div class="inline-block">');c.push('<div class="inline-block vat pdr-10">\u914d</div>');c.push('<div class="promotions-area">');var b=this.defaultGiftMap[e];var d=this.mainSkuGiftMap[e];var a=this.finalMainSbomGiftMap[e]||{};for(var f=0;f<b.length;f++){var g=d[b[f]];if(g){a[g.giftId]=g;c.push('<p class="inline-block relative" onclick="ec.product.gift.edit(); " >');c.push('<img class="vam" width="38" height="38" id="gift_'+g.giftId+'" giftskuId="'+g.giftSkuId+'"');c.push(' src="'+this.picMediaServer+g.photoPath+this.navImgSize+g.photoName+'"');c.push(' alt="'+g.giftName+'" title="'+g.giftName+'">');c.push('<span class="vam black"> x1</span>');c.push("</p>")}}this.finalMainSbomGiftMap[e]=a;c.push('<p class="inline-block">');c.push('<a class="blue" onclick="ec.product.gift.edit(this);" data-main="'+e+'">\u9009\u62e9 ></a>');c.push('<span class="">&nbsp;&nbsp;(\u9001\u5b8c\u5373\u6b62)</span>');c.push("</p>");c.push("</div>");c.push("</div>");c.push("</dd>");c.push("</dl>");c.push("<!-- 20170316-\u914d\u4ef6\u9009\u62e9-\u4fc3\u9500\u89c4\u5219-end -->");return c.join("")},popupHtml:function(){var e=[],f=[],b=0,a=0;e.push("<!-- 20170316-\u9009\u62e9\u914d\u4ef6-start -->");e.push('<div class="box-parts-area">');e.push('<ul class="clearfix" num="0">');var k="";var h=ec.product.getSku();defaultGift=this.defaultGiftMap[h];multiGiftVO=this.mainSkuGiftMap[h];multiGiftVOKeys=this.mainSkuGiftKeyMap[h];finalGift=this.finalMainSbomGiftMap[h]||{};giftSize=multiGiftVOKeys.length;var j=[],g=[];for(var d=0;d<giftSize;d++){var c=multiGiftVO[multiGiftVOKeys[d]];if(multiGiftVOKeys[d].indexOf("_")<0){if(d>0){f.push(this.renderSingleGift(g,j));j=[];g=[]}j.push(c);g.push(multiGiftVOKeys[d])}if((multiGiftVOKeys[d].indexOf("_")>0&&d>0)){j.push(c);g.push(multiGiftVOKeys[d])}if(d==(giftSize-1)){f.push(this.renderSingleGift(g,j));j=[];g=[]}}e.push(f.join(" "));e.push("</ul></div>");e.push("<!-- 20170316-\u9009\u62e9\u914d\u4ef6-end -->");return e.join(" ")},renderSingleGift:function(g,k){var j=false,h=false,b=false,l=false,a=0,e=k.length;defaultGift=k[0];finalGift=this.finalMainSbomGiftMap[this.sku];choseGift=finalGift[g[0]];for(var c=0;c<e;c++){if(choseGift.giftSkuId==k[c].giftSkuId){a=c;break}}a++;var d=Math.ceil(e/4),f=Math.ceil((a-4)/4);if(k.length<=4){h=true}if(k.length==4){b=true;l=true}else{if(k.length>4){if(f>0){b=false}else{b=true}if(f<(d-1)){l=false}else{l=true}}}if(g.length!=k.length){console.log("\u6570\u636e\u5f02\u5e38")}html=[];html.push('<li class="box-parts-item">');html.push(" <!--\u5546\u54c1\u7b80\u4ecb-\u56fe\u7247\u753b\u5eca -->");html.push('<div class="pro-content">');html.push('<div class="pro-gallery-area relative">');html.push('        <div class="pro-gallery-img"><a target="_blank" href="/product/'+choseGift.giftId+".html#"+choseGift.giftSkuId+'" id="giftHref_'+g[0]+'"><img id="giftimg_'+g[0]+'" src="'+this.picMediaServer+choseGift.photoPath+this.middleImgSize+choseGift.photoName+'" alt="'+choseGift.giftName+'"></a></div>');html.push('                    <div class="pro-gallery-nav">');html.push('                       <a onclick="ec.product.gift.prev(this);" class="pro-gallery-back '+((h==true)?"hide":"")+" "+((b==true)?"disabled":"")+'"></a>');html.push('                       <div class="pro-gallery-thumbs">');html.push('                            <ul class="clearfix" data-choose="'+f+'" style="left:'+-f*this.ITEM_WIDTH*4+'px" num="'+f+'">');for(var c=0;c<e;c++){html.push('                                <li class="'+((choseGift.giftSkuId==k[c].giftSkuId)?"current":" ")+'">');html.push('                                    <a onclick="ec.product.gift.changeGift(this);" key="'+g[c]+'" defaultGiftKey="'+g[0]+'" ><img src="'+this.picMediaServer+k[c].photoPath+this.navImgSize+k[c].photoName+'" alt="" title="'+k[c].giftAttrVal+'"><s></s></a>');html.push('                                    <span data-tips="'+(k[c].giftAttrVal.length>4?1:0)+'" title="'+k[c].giftAttrVal+'">'+k[c].giftAttrVal+"</span>");html.push("                                </li>")}html.push("		 		               </ul>");html.push("			             </div>");html.push('            			 <a onclick="ec.product.gift.next(this);" class="pro-gallery-forward '+((h==true)?"hide":"")+" "+((l==true)?"disabled":"")+'" num="0"></a>');html.push("        			  </div>");html.push("	     </div>");html.push("</div>");html.push('<div><a  class="pro-title" id="giftTitleHref_'+g[0]+'" href="/product/'+choseGift.giftId+".html#"+choseGift.giftSkuId+'"  target="_blank">'+choseGift.giftName+"</a></div>");html.push("</li>");return html.join(" ")},init:function(j,k){if(!k&&!j){return}var b={};var d=[];var c=[];this.giftArrays=k;var e=[];var h=0,a=0;for(var g=0;g<k.length;g++){var f=b[k[g].giftId];if(!f){c.push(k[g].giftId);b[k[g].giftId]=k[g];d.push(k[g].giftId);++a}else{b[k[g].giftId+"_"+h]=k[g];d.push(k[g].giftId+"_"+h);h++}}this.mainSkuGiftMap[j]=b;this.mainSkuGiftKeyMap[j]=d;this.defaultGiftMap[j]=c},cloneObj:function(c){var d,b=c.constructor===Array?[]:{};if(typeof c!=="object"){return}else{if(window.JSON){d=JSON.stringify(c),b=JSON.parse(d)}else{for(var a in c){b[a]=typeof c[a]==="object"?cloneObj(c[a]):c[a]}}}return b},getGiftsSize:function(){var c=ec.product.getSku(),a=0;multiGiftVOKeys=this.mainSkuGiftKeyMap[c];giftSize=multiGiftVOKeys.length;for(var b=0;b<giftSize;b++){if((multiGiftVOKeys[b].indexOf("_")<0)){++a}}return a}};
